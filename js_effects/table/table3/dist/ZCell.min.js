/**
 * 版权声明： 智表（ZCELL）研发团队保留所有权利，未经明确的书面许可，不得修改本文档，或以任何形式或任何手段复制产品的任何部分，进行商业用途。
 * 如需购买 请联系 邮件：108653210@qq.com
 * Version: 1.0.0.1
 * Create by zf  2018/3/2.
 */
"use strict";
var ZCell = (function() { function ZCell(a){var b=["append","<div style='overflow: auto; height: 100%;width: 100%; border: 0px solid red' >","<table>","<tr><td id='zfbooktd' ></td></tr>","<tr><td id='zfstatd'></td></tr>","</table></div>","offsetpx","html","toString","OutContainer","#zfbooktd","bookdiv","<div id ='bookdiv' class=\"book\"></div>","Sheets","CurrentSheet","jsyz","","#zfstatd"],c=new StringBuffer;c[b[0]](),c[b[0]](b[1]),c[b[0]](b[2]),c[b[0]](b[3]),c[b[0]](b[4]),c[b[0]](b[5]),ZCell[b[6]]=1,$(a)[b[7]](c[b[8]]()),this[b[9]]=$(b[10]),this[b[11]]=$(b[12])[0],this[b[13]]=[],this[b[14]]=null,ZCell[b[15]]=b[16],this[b[9]][b[0]](this[b[11]]),_initTipBar(this[b[9]]),_initStatuBar($(b[17]))}function _initStatuBar(a){var e,f,b=utf8to16(base64decode("MjAxODAxMDExMDAxMDAwMDF854yq5YWr5oiSfFYxLjAuMC4xfOaZuuihqFpDRUxM6K+V55So54mI5rWL6K+V55So5oi3fDIwMTgtMDItMjUgMTI6MzA6NDgK")),c=["<div id ='statuBardiv' class='.book div:after'></div>","append","<table id='tb_stabar' style='table-layout:fixed;'   width='550px'>","<tr>","split","fA==","jsyz","<td width='200px' style='font-size: 12px; font-weight: bold' >智表(ZCELL)&nbsp; "," &nbsp; &nbsp;授权用户：<br>【","】","</td><td class='td-stbar-cal' width='50px' align='right'> ★</td>","<td id='caldiv' width='300px'  class='td-stbar-cal'>","offsetpx","</td>","</tr>","</table>","html","toString"],d=null;d=$(c[0])[0],e=new StringBuffer,e[c[1]](),e[c[1]](c[2]),e[c[1]](c[3]),f=b[c[4]](utf8to16(base64decode(c[5]))),ZCell[c[6]]=f[0],e[c[1]](c[7]+f[2]+c[8]+f[3]+c[9]),e[c[1]](c[10]),e[c[1]](c[11]),ZCell[c[12]]=0,e[c[1]](c[13]),e[c[1]](c[14]),e[c[1]](c[15]),$(d)[c[16]](e[c[17]]()),a[c[1]](d)}function _initTipBar(a){var b=$('<div id="ZCELLtipDiv" style="position: absolute; background-color: white; border: 1px solid darkorange;display: none ;"></div>')[0];a.append(b)}ZCell.prototype.InserSheet=function(a,b,c){if(void 0==a)return alert("创建时必须指定位置索引"),void 0;if(void 0==b||void 0==c)return alert("创建时必须指定行数和列数"),void 0;if(1>b||1>c)return alert("行数和列数必须大于1"),void 0;var d=new Sheet(this.bookdiv,b,c);this.CurrentSheet=d,this.Sheets.splice(a,0,d)},ZCell.prototype.GetSheet=function(a){return this.Sheets[a]};  var Sheet=function(){function a(c,d,e){var f=["name","Sheet1","table","Cells","rows","cols","rcCros","allSelCells","nowSelCells","ROW_MIN_HEIGHT","COL_MIN_WIDTH","COL_DEFAULT_WIDTH","ROW_DEFAULT_HEIGHT","div",'<div class="sheet"></div>',"appendChild"];this[f[0]]=f[1],this[f[2]]=null,this[f[3]]=null,this[f[4]]=null,this[f[5]]=null,this[f[6]]=null,this[f[7]]=[],this[f[8]]=[],a[f[9]]=20,a[f[10]]=10,a[f[11]]=60,a[f[12]]=40,this[f[13]]=$(f[14]),b(this,d,e),c[f[15]](this[f[13]][0])}function b(b,g,h){var k,l,m,n,o,q,i=new StringBuffer;for(i.append(),' style="width:'+a.COL_DEFAULT_WIDTH+"px;height:"+a.ROW_DEFAULT_HEIGHT+'px" ',k=20,l=20,i.append("<thead><tr  >"),m="<th class='rulercro' style='width: 20px'>&nbsp;</th>",n=0,o=0,n=0;h>n;n++)m+="<th class='collab' id='colla"+n+"'  style='width: 100px'>"+e(n)+"</th>";for(i.append(m),i.append("</tr></thead>"),i.append("<tbody>"),n=0;g>n;n++){for(k+=a.ROW_DEFAULT_HEIGHT,i.append("<tr>"),i.append("<th class='rowlab' id='rowla"+n+"'>"),i.append(n+1),i.append("</th>"),o=0;h>o;o++)0===n&&(l+=a.COL_DEFAULT_WIDTH),i.append("<td>"),i.append("</td>");i.append("</tr>")}i.append("</tbody>"),q=$("<table id='tabl1'   cellspacing=\"0\" ></table>"),q.html(i.toString()),b.table=q[0],b.div.append(b.table),c(b),d(b),f(b)}function c(a){a.rows=$(a.table).find("th.rowlab"),a.cols=$(a.table).find("th.collab"),a.rcCros=$(".rulercro")}function d(a){var b,h,i,j,k,l,m,c=[],d=$(a.table).find("td"),e=0,f=-1;for(d.length,h=0;h<d.length;h++){for(i=0,j=0,k=d[h].rowSpan||1,l=d[h].colSpan||1,d[h].parentNode!==b&&(f++,b=d[h].parentNode,e=0,void 0===c[f]&&(c[f]=[])),i=0;i<c[f].length+1;i+=1)if(void 0===c[f][i]){e=i;break}for(d[h].colNo=e,i=f;f+k>i;i+=1)for(void 0===c[i]&&(c[i]=[]),j=e;e+l>j;j+=1)m=new Cell,m.rowNo=i,m.colNo=j,m.TD=d[h],c[i][j]=m}a.Cells=c}function e(a){var b="";return a>300?"outside of the maxnum":(a/26>=1&&(b+=String.fromCharCode(64+a/26)),b+=String.fromCharCode(65+a%26))}function f(a){g(a),h(a),$(a.table).on("contextmenu","",function(){return!1})}function g(a){var b,c,d,e;for($(a.table).bind("mousedown",{},function(b){var d,e,f,g,h,c=b||event;if(c.preventDefault(),!("TH"==b.target.tagName||$(b.target).parents("th").length>0)){if(!b.ctrlKey){for(d=0,e=a.allSelCells.length;e>d;d++)$(a.allSelCells[d].TD).removeClass("cell-selected");a.allSelCells.length=0}f=n(a,b.pageY),g=m(a,b.pageX),0>f||0>g||(h=p(a,f,g),void 0!=h&&(a.nowSelCells.push(h),a.nowSelCells.push(h),$(h.TD).addClass("cell-selected"),$(a.table).bind("mouseup mouseleave",{},function(){var c,d;if(0!=a.nowSelCells.length){for(c=1,d=a.nowSelCells.length;d>c;c++)a.allSelCells.push(a.nowSelCells[c]);a.nowSelCells.length=0,d=ZCell.jsyz,d.substring(d.length,d.length-5)<"10000"&&a.allSelCells.length>5&&alert("试用版最多只能选择5个单元格，请购买正版！"),q(a)}})),$("#ZCELLtipDiv").hide())}}),b=0,c=a.Cells.length;c>b;b++)for(d=0,e=a.Cells[b].length;e>d;d++)$(a.Cells[b][d].TD).bind("mouseenter",{},function(b){var c,d,e,f,g,h,i,j,k,l,q,r,s,t,u,v,w;if(0!=a.nowSelCells.length&&(c=b||window.event,d=o(c),e=0,2==d&&(e=-((parseInt($(c.target).css("border-bottom-width"))||0)+3)),0==d&&(e=(parseInt($(c.target).css("border-top-width"))||0)+3),f=0,3==d&&(f=(parseInt($(c.target).css("border-left-width"))||0)+3),1==d&&(f=-((parseInt($(c.target).css("border-right-width"))||0)+3)),g=n(a,c.pageY+e),h=m(a,c.pageX+f),!(0>g||0>h))){for(i=p(a,g,h),j=a.nowSelCells[0],k=Math.min(j.rowNo,i.rowNo),l=Math.max(j.rowNo,i.rowNo),q=Math.min(j.colNo,i.colNo),r=Math.max(j.colNo,i.colNo),s=1,t=a.nowSelCells.length;t>s;s++)u=$.inArray(a.nowSelCells[s],a.allSelCells),0>u&&$(a.nowSelCells[s].TD).removeClass("cell-selected");for(a.nowSelCells.splice(1,a.nowSelCells.length-1),v=k;l>=v;v++)for(w=q;r>=w;w++)a.nowSelCells.push(a.Cells[v][w]),$(a.Cells[v][w].TD).addClass("cell-selected")}}),$(a.Cells[b][d].TD).dblclick(function(a){var b=$("#ZCELLtipDiv");b.css("left",a.pageX+10),b.css("top",a.pageY+2),b.html($(a.target).text()),b.show()})}function h(a){function c(c){var d,e,f,g,h,j,l;if(0!=a[b[15]][b[16]]&&(d=a[b[15]][0][b[20]],e=a[b[15]][0][b[21]],!(0>d||0>e)))for(f=i[b[22]](c),g=i[b[23]](f),h=k(g),j=0;j<h[b[16]];j++)for(l=0;l<h[j][b[16]];l++)$(a[b[24]][d+j][e+l][b[17]])[b[18]](h[j][l])}function d(c){var d,e,f,g,h,j,k,m,n,o,p,q,r,s,t,u,v;if(0!=a[b[15]][b[16]]){for(d=a[b[15]],d[b[25]](function(a,c){return a[b[20]]===c[b[20]]?a[b[21]]-c[b[21]]:a[b[20]]-c[b[20]]}),e=[],f=null,g=-1,h=-1,j=-1,k=-1,m=-1,p=0,q=d[b[16]];q>p;p++)if(0==p&&(g=d[p][b[20]],j=d[p][b[21]]),h=d[p][b[20]],k=d[p][b[21]],h!=m){if(f=[],f[b[26]](d[p]),e[b[26]](f),p>0){if(n=null,e[b[16]]>0&&(n=e[e[b[16]]-2]),j!=k)return window[b[27]](b[28]),void 0;if(o=null,n[b[16]]>=f[b[16]]&&(o=n[f[b[16]]-1]),null===n||null===o||o[b[21]]!=k)return window[b[27]](b[28]),void 0}m=h}else if(f[b[26]](d[p]),p>0&&h!=g&&(n=null,e[b[16]]>0&&(n=e[e[b[16]]-2]),o=null,n[b[16]]>=f[b[16]]&&(o=n[f[b[16]]-1]),null===n||null===o||o[b[21]]!=k))return window[b[27]](b[28]),void 0;for(r=[],p=0,q=e[b[16]];q>p;p++){for(s=[],t=0,u=e[p][b[16]];u>t;t++)s[b[26]]($(e[p][t][b[17]])[b[31]]());r[b[26]](s)}v=l(r),i[b[22]](c),i[b[32]](c),i[b[33]](c,v)}}var b=["document","on","keydown","ctrlKey","fromCharCode","which","c","C","a","addHandler","copy","v","V","paste",".","allSelCells","length","TD","html","","rowNo","colNo","getEvent","getClipboardText","Cells","sort","push","alert","不能对多重选定区域使用此命令！","不能对多重选定区域使用此命令！","不能对多重选定区域使用此命令！","text","preventDefault","setClipboardText"];$(window[b[0]])[b[1]](b[2],function(e){if(e[b[3]]&&(String[b[4]](e[b[5]])===b[6]||String[b[4]](e[b[5]])===b[7])){if(void 0==window[b[8]])return i[b[9]](window[b[0]],b[10],d),void 0;d(e)}if(e[b[3]]&&(String[b[4]](e[b[5]])===b[11]||String[b[4]](e[b[5]])===b[12])){if(void 0==window[b[8]])return i[b[9]](window[b[0]],b[13],c),void 0;c(e)}if(String[b[4]](e[b[5]])==b[14])for(var f=0,g=a[b[15]][b[16]];g>f;f++)$(a[b[15]][f][b[17]])[b[18]](b[19])})}function j(a){return a.split('"').length-1}function k(a){var b,c,d,g,h,i,k,e=[],f=0;for(d=a.split("\n"),d.length>1&&""===d[d.length-1]&&d.pop(),b=0,c=d.length;c>b;b+=1){for(d[b]=d[b].split("	"),g=0,h=d[b].length;h>g;g+=1)e[f]||(e[f]=[]),i&&0===g?(k=e[f].length-1,e[f][k]=e[f][k]+"\n"+d[b][0],i&&1&j(d[b][0])&&(i=!1,e[f][k]=e[f][k].substring(0,e[f][k].length-1).replace(/""/g,'"'))):g===h-1&&0===d[b][g].indexOf('"')&&1&j(d[b][g])?(e[f].push(d[b][g].substring(1).replace(/""/g,'"')),i=!0):(e[f].push(d[b][g].replace(/""/g,'"')),i=!1);i||(f+=1)}return e}function l(a){var b,c,d,e,g,f="";for(b=0,c=a.length;c>b;b+=1){for(e=a[b].length,d=0;e>d;d+=1)d>0&&(f+="	"),g=a[b][d],f+="string"==typeof g?g.indexOf("\n")>-1?'"'+g.replace(/"/g,'""')+'"':g:null===g||void 0===g?"":g;b!==c-1&&(f+="\n")}return f}function m(a,b){var e,f,c=["cols","offset","left","offsetpx","length","width"],d=a[c[0]];if(b<$(d[0])[c[1]]()[c[2]]||1==ZCell[c[3]])return-1;for(e=0;e<d[c[4]];e++)if(f=$(d[e]),f[c[1]]()[c[2]]+f[c[5]]()>b)return e;return-1}function n(a,b){var e,f,g,c=["rows","offset","top","offsetpx","length","height"],d=a[c[0]];if(b<$(d[0])[c[1]]()[c[2]]||1==ZCell[c[3]])return-1;for(e=d[c[4]],f=0;e>f;f++)if(g=$(d[f]),g[c[1]]()[c[2]]+g[c[5]]()>b)return f;return-1}function o(a){var b=a.target,c=b.offsetWidth,d=b.offsetHeight,e=(a.pageX-$(b).offset().left-c/2)*(c>d?d/c:1),f=(a.pageY-$(b).offset().top-d/2)*(d>c?c/d:1),g=Math.round((Math.atan2(f,e)*(180/Math.PI)+180)/90+3)%4;return g}function p(a,b,c){return a.GetCell(b,c)}function q(a){var b,c,d,e,f,g,h,i;if(0!=a.allSelCells.length){for(b=0,c=0,d=0,f=0,g=0,h=a.allSelCells.length;h>g;g++)e=$(a.allSelCells[g].TD).text(),isNaN(e)?f++:""!=e&&null!=e&&(b++,c+=Number(e));d=0==b?"0":(c/b).toFixed(2),i="平均值："+d,i+="&nbsp;&nbsp; ",i+="计数："+(b+f),i+=" &nbsp;&nbsp;",i+="求和："+c,$("#caldiv").html(i)}}var i={addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeHandler:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},getEvent:function(a){return a?a:window.event},getClipboardText:function(a){var b=a.clipboardData||window.clipboardData;return b.getData("text")},setClipboardText:function(a,b){return a.clipboardData?a.clipboardData.setData("text/plain",b):window.clipboardData?window.clipboardData.setData("text",b):void 0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}};return a}();  Sheet.prototype.SetColWidth=function(b,a){$(this.cols[b]).css("width",a)};Sheet.prototype.SetRowHeight=function(b,a){$(this.rows[b]).css("height",a)};Sheet.prototype.SetCellStyle=function(c,b,a){$(this.GetCell(c,b).TD).css(a)};Sheet.prototype.GetCell=function(b,a){return this.Cells[b][a]};Sheet.prototype.SetCellString=function(c,a,b){$(this.GetCell(c,a).TD).html(b)};Sheet.prototype.GetCellString=function(b,a){return $(this.GetCell(b,a).TD).text()};Sheet.prototype.ShowColLab=function(a){if(a==0){$(".collab").css("height","0");$(".collab").css("line-height","0");$(".rulercro").css("height","0");$(".rulercro").css("line-height","0")}else{if(a==1){$(".collab").css("height","20");$(".collab").css("line-height","1");$(".rulercro").css("height","20");$(".rulercro").css("line-height","1")}else{alert("参数异常！")}}};Sheet.prototype.ShowRowLab=function(a){if(a==0){$(".rowlab").css("width","0");$(".rulercro").css("width","0")}else{if(a==1){$(".rowlab").css("width","20");$(".rulercro").css("width","20")}else{alert("参数异常！")}}};Sheet.prototype.LoadJsonData=function(d){var c=this;for(var b=0;b<d.length;b++){if(b>c.Cells.length-1){continue}for(var a=0;a<d[b].length;a++){if(a>c.Cells[b].length-1){continue}$(c.Cells[b][a].TD).html(d[b][a])}}};Sheet.prototype.GetDataJson=function(){var d=[];var c=this;for(var b=0;b<c.Cells.length;b++){d[b]=[];for(var a=0;a<c.Cells[b].length;a++){d[b][a]=$(c.Cells[b][a].TD).text()}}return d};function Cell(){this.rowNo=-1;this.colNo=-1;this.TD={}}function StringBuffer(){this._strings_=[]}StringBuffer.prototype.append=function(a){this._strings_.push(a)};StringBuffer.prototype.toString=function(){return this._strings_.join("")};var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(g){var c,e,a;var f,d,b;a=g.length;e=0;c="";while(e<a){f=g.charCodeAt(e++)&255;if(e==a){c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt((f&3)<<4);c+="==";break}d=g.charCodeAt(e++);if(e==a){c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=base64EncodeChars.charAt((d&15)<<2);c+="=";break}b=g.charCodeAt(e++);c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=base64EncodeChars.charAt(((d&15)<<2)|((b&192)>>6));c+=base64EncodeChars.charAt(b&63)}return c}function base64decode(h){var g,f,d,b;var e,a,c;a=h.length;e=0;c="";while(e<a){do{g=base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&g==-1);if(g==-1){break}do{f=base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&f==-1);if(f==-1){break}c+=String.fromCharCode((g<<2)|((f&48)>>4));do{d=h.charCodeAt(e++)&255;if(d==61){return c}d=base64DecodeChars[d]}while(e<a&&d==-1);if(d==-1){break}c+=String.fromCharCode(((f&15)<<4)|((d&60)>>2));do{b=h.charCodeAt(e++)&255;if(b==61){return c}b=base64DecodeChars[b]}while(e<a&&b==-1);if(b==-1){break}c+=String.fromCharCode(((d&3)<<6)|b)}return c}function utf16to8(e){var b,d,a,f;b="";a=e.length;for(d=0;d<a;d++){f=e.charCodeAt(d);if((f>=1)&&(f<=127)){b+=e.charAt(d)}else{if(f>2047){b+=String.fromCharCode(224|((f>>12)&15));b+=String.fromCharCode(128|((f>>6)&63));b+=String.fromCharCode(128|((f>>0)&63))}else{b+=String.fromCharCode(192|((f>>6)&31));b+=String.fromCharCode(128|((f>>0)&63))}}}return b}function utf8to16(g){var b,e,a,h;var f,d;b="";a=g.length;e=0;while(e<a){h=g.charCodeAt(e++);switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=g.charAt(e-1);break;case 12:case 13:f=g.charCodeAt(e++);b+=String.fromCharCode(((h&31)<<6)|(f&63));break;case 14:f=g.charCodeAt(e++);d=g.charCodeAt(e++);b+=String.fromCharCode(((h&15)<<12)|((f&63)<<6)|((d&63)<<0));break}}return b}function addWaterMarker(d,e){var c=document.createElement("canvas");var a=d;a.append(c);c.width=400;c.height=200;c.style.display="none";var b=c.getContext("2d");b.rotate(-20*Math.PI/180);b.font="16px Microsoft JhengHei";b.fillStyle="rgba(17, 17, 17, 0.50)";b.textAlign="left";b.textBaseline="Middle";b.fillText(e,c.width/3,c.height/2);$(d).css("background-color","yellow!important")};
    //返回在这个作用域中创建的类，使之在外层作用域中即后面代码的所有位置都可用
    return ZCell;
}());
