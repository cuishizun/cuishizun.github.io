(function(e){function n(s){w=Math.floor(e.fn.jigsaw.defaults.width/e.fn.jigsaw.defaults.x);h=Math.floor(e.fn.jigsaw.defaults.height/e.fn.jigsaw.defaults.y);var o=s.children(".jigsaw_panel_").children("div").length;for(i=0;i<o;i++){var u=Math.floor(Math.random()*3+0);var a=Math.floor(Math.random()*3+0);var f="-"+u*w+"px -"+a*h+"px";s.children(".jigsaw_panel_").children("div:eq("+i+")").css("background-position",f)}if(Math.floor(Math.random()*5+0)==2){t=setTimeout(function(){r(s)},e.fn.jigsaw.defaults.freq)}else t=setTimeout(function(){n(s)},e.fn.jigsaw.defaults.freq)}function r(r){w=Math.floor(e.fn.jigsaw.defaults.width/e.fn.jigsaw.defaults.x);h=Math.floor(e.fn.jigsaw.defaults.height/e.fn.jigsaw.defaults.y);for(i=0;i<e.fn.jigsaw.defaults.x;i++){for(j=0;j<e.fn.jigsaw.defaults.y;j++){pos="block"+i+j;r.children(".jigsaw_panel_").children("div[pos='"+pos+"']").css("background-position","-"+j*w+"px -"+i*h+"px").css("width",w+"px").css("height",h+"px").css("background-image","url("+e.fn.jigsaw.defaults.image+")")}}t=setTimeout(function(){n(r)},e.fn.jigsaw.defaults.freq)}e.fn.jigsaw=function(t){var r=e.extend({},e.fn.jigsaw.defaults,t);e.fn.jigsaw.defaults=r;e.fn.jigsaw.defaults.image=this.children("img").attr("src");this.append('<div class="jigsaw_panel_"></div>');e.fn.jigsaw.defaults.width=this.children("img").attr("width");e.fn.jigsaw.defaults.height=this.children("img").attr("height");obj=this.children(".jigsaw_panel_");obj.css("width",parseInt(e.fn.jigsaw.defaults.width)+parseInt(e.fn.jigsaw.defaults.x*e.fn.jigsaw.defaults.margin*2)+parseInt(e.fn.jigsaw.defaults.error)+"px").css("height",parseInt(e.fn.jigsaw.defaults.height)+parseInt(e.fn.jigsaw.defaults.y*e.fn.jigsaw.defaults.margin*2)+"px");w=Math.floor(e.fn.jigsaw.defaults.width/e.fn.jigsaw.defaults.x);h=Math.floor(e.fn.jigsaw.defaults.height/e.fn.jigsaw.defaults.y);for(i=0;i<e.fn.jigsaw.defaults.x;i++){for(j=0;j<e.fn.jigsaw.defaults.y;j++){pos="block"+i+j;obj.append("<div pos='"+pos+"'></div>");obj.children("div[pos='"+pos+"']").css("background-position","-"+j*w+"px -"+i*h+"px").css("width",w+"px").css("height",h+"px").css("background-image","url("+e.fn.jigsaw.defaults.image+")").css("display","inline-block").css("margin",e.fn.jigsaw.defaults.margin)}obj.append("<div class='clearfix'></div>")}this.children("img").hide();obj.fadeIn();n(this)};e.fn.jigsaw.defaults={width:100,height:200,x:4,y:4,margin:3,error:16,freq:2e3,image:""}})(jQuery)